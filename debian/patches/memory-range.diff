---
 pci-userspace/src-gnu/pci_user-gnu.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/pci-userspace/src-gnu/pci_user-gnu.c
+++ b/pci-userspace/src-gnu/pci_user-gnu.c
@@ -170,7 +170,8 @@ rumpcomp_pci_map(unsigned long addr, uns
 found:
 
 	pci_device_map_range(pci_devices[i], addr, len, 1, &ret);
-	return pci_devices[i]->regions[residx].memory;
+	pci_devices[i]->regions[residx].memory = ret;
+	return ret;
 }
 
 void
